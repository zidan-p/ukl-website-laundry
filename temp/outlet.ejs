<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="3_member.css">
    <style>
      .title-section{
          background-color: #9e8cff;
      }
  </style>
    <title>Hello, world!</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light" >
        <div class="container">
            <a class="navbar-brand" href="#">Navbar</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                <a class="nav-link active" href="#">Home</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">User</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">Member</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">Paket</a>
                </li>
                <li class="nav-item">
                <a class="nav-link" href="#">transaksi</a>
                </li>
            </ul>
            </div>
        </div>
    </nav>

    <!-- title section -->
    <div class="container-fluid title-section">
        <div class="container pt-5 pb-5">
            <h1>Halaman daftar outlet <i class="bi bi-shop"></i></h1>
            <small >halaman tempat untuk mengatur semua outlet yang terhubung dengan aplikasi ini</small>
        </div>
    </div>

    <!-- card general info section -->
    <div class="card-section container-fluid">
        <div class="container py-5">
            <div class="row row-cols-md-4 row-cols-sm-2" >


                <div class="col">
                    <div class="card" style="width: 18rem;">
                        <div class="card-body">
                            <h5 class="card-title">Jumlah outlet</h5>
                            <h1><strong><%= outlet.length %> </strong></h1>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>


    <!-- person card section -->
    <!-- section yang berisi daata card person -->
    <div class="contaier-fluid person-section">
        <div class="container py-5">
            <h2>Daftar semua Outlet </h2>
        </div>
        
        <div class="container container-card">
            <div class="row row-cols-md-4 row-cols-sm-2 gy-5">


                <div class="col col-card">
                    <div class="card border-dark" style="width: 18rem;">
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item d-flex justify-content-between">
                              <strong class="mb-0">Outlet jaya</strong>
                              <a href="#" class="btn btn-danger btn-sm">X</a>
                            </li>
                        </ul>
                        <div class="card-body">
                            <h1 class="text-center"><strong><i class="bi bi-shop"></i></strong></h1>
                            <strong><i class="bi bi-telephone-fill"></i> 08767676767</strong>
                            <p class=""><i class="bi bi-geo-alt-fill"></i> bagorejo, srono</p>
                            <a href="#" class="btn btn-sm btn-primary"><i class="bi bi-pencil-square"></i> Edit</a>
                            <button class="btn btn-sm btn-primary" data-idOutlet="1234" data-bs-toggle="modal" data-bs-target="#modalinfo">
                                <i class="bi bi-info-circle"></i> Info
                            </button>
                        </div>
                    </div>
                </div>

                <% outlet.forEach((outlet_arr) => { %> 
                  <div class="col col-card">
                    <div class="card border-dark" style="width: 18rem;">
                        <ul class="list-group list-group-flush">
                          <li class="list-group-item d-flex justify-content-between">
                              <strong class="mb-0"><%= outlet_arr.nama %> </strong>
                              <button class="btn btn-danger btn-sm btn-delete" data-idOutlet="<%= outlet_arr.id %> ">X</button>
                            </li>
                        </ul>
                        <div class="card-body">
                            <h1 class="text-center"><strong><i class="bi bi-shop"></i></strong></h1>
                            <strong><i class="bi bi-telephone-fill"></i> <%= outlet_arr.tlp %> </strong>
                            <p class=""><i class="bi bi-geo-alt-fill"></i> <%= outlet_arr.alamat %> </p>
                            <a href="update/<%= outlet_arr.id %> " class="btn btn-sm btn-primary"><i class="bi bi-pencil-square"></i> Edit</a>
                            <button class="btn btn-sm btn-primary button-mdl" data-idOutlet="<%= outlet_arr.id %> " data-bs-toggle="modal" data-bs-target="#modalinfo">
                                <i class="bi bi-info-circle"></i> Info
                            </button>
                        </div>
                    </div>
                </div>
                <% }) %> 
            </div>
        </div>
    </div>

    <!-- untuk footer -->
    <footer>
        <div class="container-fuild p-3 mt-5 bg-secondary ">
            <div class="d-flex justify-content-center align-items-center"><p class="mb-0">create by me</p></div>
            
        </div>
    </footer>

    <!-- untuk modal -->
    <div class="modal fade" tabindex="-1" id="modalinfo">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Outlet jaya</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <h5>Daftar paket</h5>
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Nama paket</th>
                    <th scope="col">Jenis</th>
                    <th scope="col">Harga</th>
                  </tr>
                </thead>
                <tbody id="tabel">
                  <tr>
                    <th scope="row">1</th>
                    <td>paket komplit</td>
                    <td>kiloan</td>
                    <td>12.000</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <% let budi = "hahaha" %> 
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script>

      //untuk modal
      let buttons = document.querySelectorAll('.button-mdl');
      buttons.forEach(button => {
        button.addEventListener('click', async function(e){
          let idOutlet = this.getAttribute('data-idOutlet');
          let outlet = JSON.parse('<%- JSON.stringify(outlet) %>'); //ejs tidak dapat di passingkan nilainya secara langsung, harus berupa string dan harus diinisialisasi berupa string pula, oleh karena itu menggunakan JSON.stringify untuk menjadaika strind dan JSON.parse untuk menjadikan object
          let paket = outlet.find(arr => arr.id == idOutlet).paket;
          // console.log(paket);

          let str = paket.map((pak,i) => {
            return `
                  <tr>
                    <th scope="row">${i+1}</th>
                    <td>${pak.nama_paket}</td>
                    <td>${pak.jenis}</td>
                    <td>${pak.harga}</td>
                  </tr>
            `
          })
          if(str.length == 0){ //cek apakah ada isi paket
            str = `<tr>tidak ada paket tersedia</tr>`
            document.querySelector('#tabel').innerHTML = str
          }else{
            document.querySelector('#tabel').innerHTML = str.join('')
          }
        })
      });


      //untuk hapus
      let containerCard = document.querySelector('.container-card');
      containerCard.addEventListener('click', function(e){
        if(e.target.className == 'btn btn-danger btn-sm btn-delete'){ //ini adalah daftar class untuk tombol hapus, saya masuakn semua class karena saya sedang terburu2 dan aras2en
          console.log(e.target.parentElement.parentElement.parentElement.parentElement);

          idOutlet = e.target.getAttribute('data-idOutlet');
          if(confirm('yakin ingin menghapus data ini??')){
            //untuk menyembunyikan element
            e.target.parentElement.parentElement.parentElement.parentElement.style.display = 'none'; //untuk mendapatkan parent atas yang saya inginkan

            fetch(`http://localhost:8080/outlet/${idOutlet}`, {method: 'DELETE'})
              .then(res => alert('data telah dihapus'))
              .catch(err => alert("data gagal dihapus"));
          }
        }
      })
    </script>
    </body>
</html>